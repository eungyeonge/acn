<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë™ë¬¼ë³‘ì› ìƒì„¸ | ACN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="include.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- âœ… í—¤ë” -->
  <div id="header"></div>

  <!-- âœ… ìƒì„¸ì •ë³´ -->
  <section class="max-w-4xl mx-auto px-4 py-12">
    <h1 id="hospitalName" class="text-3xl font-bold mb-2">ë³‘ì› ì´ë¦„</h1>
    <span id="hospitalStatus" class="px-3 py-1 text-sm rounded-full"></span>

    <hr class="my-6"/>

    <!-- ì§€ë„ -->
    <div id="map" class="w-full h-96 rounded shadow"></div>

    <!-- ê¸¸ì°¾ê¸° ë²„íŠ¼ -->
    <div class="mt-6 flex gap-3">
      <a id="directionBtn" 
         target="_blank" 
         class="px-6 py-3 bg-blue-500 text-white rounded hover:bg-blue-600">
         ğŸš— ê¸¸ì°¾ê¸°
      </a>
    </div>

    <!-- ìƒì„¸ì •ë³´ -->
    <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <h3 class="text-sm font-semibold text-gray-500">ì „í™”ë²ˆí˜¸</h3>
        <p id="hospitalTel" class="text-lg">-</p>
      </div>
      <div>
        <h3 class="text-sm font-semibold text-gray-500">ì£¼ì†Œ</h3>
        <p id="hospitalAddr" class="text-lg">-</p>
      </div>
    </div>
  </section>

  <!-- âœ… í‘¸í„° -->
  <div id="footer"></div>

  <script>
    let hospitalData = [];

    Papa.parse("hospitals.csv", {
      download: true,
      header: true,
      complete: function(results) {
        hospitalData = results.data;
        renderHospital();
      }
    });

    function renderHospital() {
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name");
      const h = hospitalData.find(item => item["FRNM_NM"] === name);

      if (!h) {
        document.getElementById("hospitalName").textContent = "ë³‘ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      document.getElementById("hospitalName").textContent = h["FRNM_NM"];
      document.getElementById("hospitalAddr").textContent = h["RN_ADDR"];
      document.getElementById("hospitalTel").textContent = h["RPRS_TELNO"] || "-";

      const statusEl = document.getElementById("hospitalStatus");
      if (!h["OPR_TIME_INFO"] || h["OPR_TIME_INFO"].includes("íœ´ë¬´")) {
        statusEl.textContent = "íœ´ë¬´";
        statusEl.className = "px-3 py-1 text-sm bg-red-100 text-red-700 rounded-full";
      } else {
        statusEl.textContent = "ì˜ì—…/ì •ìƒ";
        statusEl.className = "px-3 py-1 text-sm bg-green-100 text-green-700 rounded-full";
      }

      const lat = parseFloat(h["LA_VLUE"]) || 37.5665;
      const lon = parseFloat(h["LO_VLUE"]) || 126.9780;

      const map = L.map("map").setView([lat, lon], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19
      }).addTo(map);
      L.marker([lat, lon]).addTo(map).bindPopup(h["FRNM_NM"]).openPopup();

      document.getElementById("directionBtn").href =
        `https://map.kakao.com/link/to/${encodeURIComponent(h["FRNM_NM"])},${lat},${lon}`;
    }
  </script>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxXE-GP-tLNN5zZ81j-A0QtcN6RKIRxZE",
      authDomain: "acnproject-619dc.firebaseapp.com",
      projectId: "acnproject-619dc",
      storageBucket: "acnproject-619dc.firebasestorage.app",
      messagingSenderId: "205809961445",
      appId: "1:205809961445:web:7603261a5bae3316d7070c",
      measurementId: "G-4H0S2GDMGJ"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</body>
</html>
