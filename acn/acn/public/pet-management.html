<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬ | ACN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="include.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- âœ… í—¤ë” ìë™ ì‚½ì… -->
  <div id="header"></div>

  <!-- âœ… ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬ -->
  <section class="max-w-6xl mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h1 class="text-2xl font-bold mb-6 text-center">ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬</h1>
      
      <!-- ë°˜ë ¤ë™ë¬¼ ì¶”ê°€ ë²„íŠ¼ -->
      <div class="text-center mb-6">
        <button id="addPetBtn" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">
          + ë°˜ë ¤ë™ë¬¼ ë“±ë¡
        </button>
      </div>

      <!-- ë°˜ë ¤ë™ë¬¼ ëª©ë¡ -->
      <div id="petList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- ë°˜ë ¤ë™ë¬¼ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>

      <!-- ë°˜ë ¤ë™ë¬¼ì´ ì—†ì„ ë•Œ ë©”ì‹œì§€ -->
      <div id="emptyMessage" class="text-center py-12 hidden">
        <div class="text-6xl mb-4">ğŸ¾</div>
        <h3 class="text-lg font-semibold text-gray-600 mb-2">ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-500 mb-4">ì²« ë²ˆì§¸ ë°˜ë ¤ë™ë¬¼ì„ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
        <button onclick="addPet()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
          ë°˜ë ¤ë™ë¬¼ ë“±ë¡í•˜ê¸°
        </button>
      </div>
    </div>
  </section>

  <!-- ë°˜ë ¤ë™ë¬¼ ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="petModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto">
      <h3 id="modalTitle" class="text-lg font-semibold mb-4">ë°˜ë ¤ë™ë¬¼ ë“±ë¡</h3>
      
      <form id="petForm">
        <!-- ì‚¬ì§„ ì—…ë¡œë“œ -->
        <div class="mb-6 text-center">
          <div id="photoPreview" class="w-32 h-32 mx-auto mb-3 border-2 border-dashed border-gray-300 rounded-full flex items-center justify-center bg-gray-50 overflow-hidden">
            <span class="text-gray-400 text-4xl">ğŸ“·</span>
          </div>
          <input type="file" id="petPhoto" accept="image/*" class="hidden">
          <button type="button" onclick="document.getElementById('petPhoto').click()" 
                  class="text-sm text-blue-600 hover:text-blue-800">ì‚¬ì§„ ì„ íƒ</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- ì´ë¦„ -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-1" for="petName">ì´ë¦„ *</label>
            <input type="text" id="petName" name="petName" placeholder="ì˜ˆ: ë©ë©ì´" 
                   class="w-full border px-3 py-2 rounded" required>
          </div>
          
          <!-- ì¢…ë¥˜ -->
          <div>
            <label class="block text-sm font-medium mb-1" for="petType">ì¢…ë¥˜ *</label>
            <select id="petType" name="petType" class="w-full border px-3 py-2 rounded" required>
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="dog">ê°•ì•„ì§€</option>
              <option value="cat">ê³ ì–‘ì´</option>
            </select>
          </div>
          
          <!-- í’ˆì¢… -->
          <div>
            <label class="block text-sm font-medium mb-1" for="breed">í’ˆì¢…</label>
            <input type="text" id="breed" name="breed" placeholder="ì˜ˆ: ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„" 
                   class="w-full border px-3 py-2 rounded">
          </div>
          
          <!-- ìƒë…„ì›”ì¼ -->
          <div>
            <label class="block text-sm font-medium mb-1" for="birthDate">ìƒë…„ì›”ì¼</label>
            <input type="date" id="birthDate" name="birthDate" 
                   class="w-full border px-3 py-2 rounded">
          </div>
          
          <!-- ì„±ë³„ -->
          <div>
            <label class="block text-sm font-medium mb-1" for="gender">ì„±ë³„</label>
            <select id="gender" name="gender" class="w-full border px-3 py-2 rounded">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="male">ìˆ˜ì»·</option>
              <option value="female">ì•”ì»·</option>
            </select>
          </div>
          
          <!-- ì¤‘ì„±í™” ì—¬ë¶€ -->
          <div>
            <label class="block text-sm font-medium mb-1" for="neutered">ì¤‘ì„±í™”</label>
            <select id="neutered" name="neutered" class="w-full border px-3 py-2 rounded">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
              <option value="yes">ì™„ë£Œ</option>
              <option value="no">ë¯¸ì™„ë£Œ</option>
            </select>
          </div>
          
          <!-- ëª¸ë¬´ê²Œ -->
          <div>
            <label class="block text-sm font-medium mb-1" for="weight">ëª¸ë¬´ê²Œ (kg)</label>
            <input type="number" id="weight" name="weight" step="0.1" placeholder="ì˜ˆ: 5.5" 
                   class="w-full border px-3 py-2 rounded">
          </div>
        </div>
        
        <!-- íŠ¹ì´ì‚¬í•­ -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1" for="notes">íŠ¹ì´ì‚¬í•­ / ë©”ëª¨</label>
          <textarea id="notes" name="notes" placeholder="ì•Œë ˆë¥´ê¸°, ì§ˆë³‘, íŠ¹ë³„í•œ ì£¼ì˜ì‚¬í•­ ë“±" 
                    class="w-full border px-3 py-2 rounded h-20"></textarea>
        </div>
        
        <div class="flex gap-3 mt-6">
          <button type="button" id="cancelBtn" class="flex-1 px-4 py-2 border rounded hover:bg-gray-50">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
            ì €ì¥
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ë°˜ë ¤ë™ë¬¼ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
  <div id="petDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
      <div id="petDetailContent" class="text-center">
        <!-- ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>
      <div class="flex gap-3 mt-6">
        <button id="editPetBtn" class="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          ìˆ˜ì •
        </button>
        <button id="deletePetBtn" class="flex-1 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">
          ì‚­ì œ
        </button>
        <button id="closeDetailBtn" class="flex-1 px-4 py-2 border rounded hover:bg-gray-50">
          ë‹«ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- í‘¸í„° ìë™ ì‚½ì… -->
  <div id="footer"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxXE-GP-tLNN5zZ81j-A0QtcN6RKIRxZE",
      authDomain: "acnproject-619dc.firebaseapp.com",
      projectId: "acnproject-619dc",
      storageBucket: "acnproject-619dc.firebasestorage.app",
      messagingSenderId: "205809961445",
      appId: "1:205809961445:web:7603261a5bae3316d7070c",
      measurementId: "G-4H0S2GDMGJ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Firebase ì¸ì¦ ìƒíƒœ ì²´í¬
    auth.onAuthStateChanged((user) => {
      if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "login.html";
      }
    });

    // ì „ì—­ ë³€ìˆ˜
    let editingPetId = null;
    let currentPetForDetail = null;

    // ë°˜ë ¤ë™ë¬¼ ë°ì´í„° (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°)
    let pets = JSON.parse(localStorage.getItem('pets') || '[]');

    // í˜ì´ì§€ ì´ˆê¸°í™”
    function initPage() {
      updatePetList();
    }

    // ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updatePetList() {
      const petList = document.getElementById('petList');
      const emptyMessage = document.getElementById('emptyMessage');
      
      if (pets.length === 0) {
        petList.innerHTML = '';
        emptyMessage.classList.remove('hidden');
        return;
      }

      emptyMessage.classList.add('hidden');
      petList.innerHTML = '';

      pets.forEach(pet => {
        const petCard = document.createElement('div');
        petCard.className = 'bg-white border rounded-lg shadow hover:shadow-md transition cursor-pointer';
        petCard.onclick = () => showPetDetail(pet.id);
        
        // ë‚˜ì´ ê³„ì‚°
        const age = pet.birthDate ? calculateAge(pet.birthDate) : 'ì•Œ ìˆ˜ ì—†ìŒ';
        
        // ì„±ë³„ ì•„ì´ì½˜
        const genderIcon = pet.gender === 'male' ? 'â™‚ï¸' : pet.gender === 'female' ? 'â™€ï¸' : '';
        
        // ì¢…ë¥˜ ì•„ì´ì½˜
        const typeIcon = getTypeIcon(pet.type);

        petCard.innerHTML = `
          <div class="p-4">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-16 h-16 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center">
                ${pet.photo ? 
                  `<img src="${pet.photo}" alt="${pet.name}" class="w-full h-full object-cover">` : 
                  `<span class="text-2xl">${typeIcon}</span>`
                }
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-lg">${pet.name} ${genderIcon}</h3>
                <p class="text-sm text-gray-600">${getTypeText(pet.type)} ${pet.breed ? `â€¢ ${pet.breed}` : ''}</p>
                <p class="text-sm text-gray-500">${age}</p>
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-2 text-sm">
              ${pet.weight ? `<div class="text-gray-600">ëª¸ë¬´ê²Œ: ${pet.weight}kg</div>` : ''}
              ${pet.neutered ? `<div class="text-gray-600">ì¤‘ì„±í™”: ${pet.neutered === 'yes' ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}</div>` : ''}
            </div>
            
            ${pet.notes ? `<p class="text-xs text-gray-500 mt-2 truncate">${pet.notes}</p>` : ''}
          </div>
        `;
        
        petList.appendChild(petCard);
      });
    }

    // ë‚˜ì´ ê³„ì‚°
    function calculateAge(birthDate) {
      const birth = new Date(birthDate);
      const today = new Date();
      const ageInMonths = (today.getFullYear() - birth.getFullYear()) * 12 + today.getMonth() - birth.getMonth();
      
      if (ageInMonths < 12) {
        return `${ageInMonths}ê°œì›”`;
      } else {
        const years = Math.floor(ageInMonths / 12);
        const months = ageInMonths % 12;
        return months > 0 ? `${years}ì„¸ ${months}ê°œì›”` : `${years}ì„¸`;
      }
    }

    // ì¢…ë¥˜ë³„ ì•„ì´ì½˜
    function getTypeIcon(type) {
      const icons = {
        dog: 'ğŸ•',
        cat: 'ğŸ±', 
        rabbit: 'ğŸ°',
        hamster: 'ğŸ¹',
        bird: 'ğŸ¦',
        fish: 'ğŸ ',
        other: 'ğŸ¾'
      };
      return icons[type] || 'ğŸ¾';
    }

    // ì¢…ë¥˜ë³„ í…ìŠ¤íŠ¸
    function getTypeText(type) {
      const texts = {
        dog: 'ê°•ì•„ì§€',
        cat: 'ê³ ì–‘ì´',
        rabbit: 'í† ë¼', 
        hamster: 'í–„ìŠ¤í„°',
        bird: 'ìƒˆ',
        fish: 'ë¬¼ê³ ê¸°',
        other: 'ê¸°íƒ€'
      };
      return texts[type] || 'ì•Œ ìˆ˜ ì—†ìŒ';
    }

    // ë°˜ë ¤ë™ë¬¼ ì¶”ê°€
    function addPet() {
      editingPetId = null;
      document.getElementById('modalTitle').textContent = 'ë°˜ë ¤ë™ë¬¼ ë“±ë¡';
      document.getElementById('petForm').reset();
      document.getElementById('photoPreview').innerHTML = '<span class="text-gray-400 text-4xl">ğŸ“·</span>';
      document.getElementById('petModal').classList.remove('hidden');
      document.getElementById('petModal').classList.add('flex');
    }

    // ë°˜ë ¤ë™ë¬¼ ìˆ˜ì •
    function editPet(id) {
      const pet = pets.find(p => p.id === id);
      if (!pet) return;

      editingPetId = id;
      document.getElementById('modalTitle').textContent = 'ë°˜ë ¤ë™ë¬¼ ì •ë³´ ìˆ˜ì •';
      
      // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
      document.getElementById('petName').value = pet.name;
      document.getElementById('petType').value = pet.type || '';
      document.getElementById('breed').value = pet.breed || '';
      document.getElementById('birthDate').value = pet.birthDate || '';
      document.getElementById('gender').value = pet.gender || '';
      document.getElementById('neutered').value = pet.neutered || '';
      document.getElementById('weight').value = pet.weight || '';
      document.getElementById('notes').value = pet.notes || '';
      
      // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°
      const photoPreview = document.getElementById('photoPreview');
      if (pet.photo) {
        photoPreview.innerHTML = `<img src="${pet.photo}" alt="${pet.name}" class="w-full h-full object-cover">`;
      } else {
        photoPreview.innerHTML = '<span class="text-gray-400 text-4xl">ğŸ“·</span>';
      }
      
      document.getElementById('petModal').classList.remove('hidden');
      document.getElementById('petModal').classList.add('flex');
    }

    // ë°˜ë ¤ë™ë¬¼ ìƒì„¸ë³´ê¸°
    function showPetDetail(id) {
      const pet = pets.find(p => p.id === id);
      if (!pet) return;

      currentPetForDetail = pet;
      const age = pet.birthDate ? calculateAge(pet.birthDate) : 'ì•Œ ìˆ˜ ì—†ìŒ';
      const typeIcon = getTypeIcon(pet.type);
      const genderIcon = pet.gender === 'male' ? 'â™‚ï¸' : pet.gender === 'female' ? 'â™€ï¸' : '';

      document.getElementById('petDetailContent').innerHTML = `
        <div class="w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center">
          ${pet.photo ? 
            `<img src="${pet.photo}" alt="${pet.name}" class="w-full h-full object-cover">` : 
            `<span class="text-4xl">${typeIcon}</span>`
          }
        </div>
        <h2 class="text-xl font-bold mb-2">${pet.name} ${genderIcon}</h2>
        <div class="text-left space-y-2 max-w-sm mx-auto">
          <div class="grid grid-cols-2 gap-4">
            <div><span class="font-medium">ì¢…ë¥˜:</span> ${getTypeText(pet.type)}</div>
            <div><span class="font-medium">ë‚˜ì´:</span> ${age}</div>
            ${pet.breed ? `<div class="col-span-2"><span class="font-medium">í’ˆì¢…:</span> ${pet.breed}</div>` : ''}
            ${pet.gender ? `<div><span class="font-medium">ì„±ë³„:</span> ${pet.gender === 'male' ? 'ìˆ˜ì»·' : 'ì•”ì»·'}</div>` : ''}
            ${pet.neutered ? `<div><span class="font-medium">ì¤‘ì„±í™”:</span> ${pet.neutered === 'yes' ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}</div>` : ''}
            ${pet.weight ? `<div class="col-span-2"><span class="font-medium">ëª¸ë¬´ê²Œ:</span> ${pet.weight}kg</div>` : ''}
          </div>
          ${pet.notes ? `<div class="mt-3 pt-3 border-t"><span class="font-medium">íŠ¹ì´ì‚¬í•­:</span><br>${pet.notes}</div>` : ''}
        </div>
      `;

      document.getElementById('petDetailModal').classList.remove('hidden');
      document.getElementById('petDetailModal').classList.add('flex');
    }

    // ë°˜ë ¤ë™ë¬¼ ì‚­ì œ
    function deletePet(id) {
      if (confirm('ì •ë§ë¡œ ì´ ë°˜ë ¤ë™ë¬¼ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        pets = pets.filter(p => p.id !== id);
        localStorage.setItem('pets', JSON.stringify(pets));
        updatePetList();
        
        // ìƒì„¸ë³´ê¸° ëª¨ë‹¬ì´ ì—´ë ¤ìˆë‹¤ë©´ ë‹«ê¸°
        document.getElementById('petDetailModal').classList.add('hidden');
        document.getElementById('petDetailModal').classList.remove('flex');
      }
    }

    // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('petPhoto').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('photoPreview').innerHTML = 
            `<img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" class="w-full h-full object-cover">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('addPetBtn').addEventListener('click', addPet);

    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('petModal').classList.add('hidden');
      document.getElementById('petModal').classList.remove('flex');
    });

    document.getElementById('editPetBtn').addEventListener('click', () => {
      if (currentPetForDetail) {
        document.getElementById('petDetailModal').classList.add('hidden');
        document.getElementById('petDetailModal').classList.remove('flex');
        editPet(currentPetForDetail.id);
      }
    });

    document.getElementById('deletePetBtn').addEventListener('click', () => {
      if (currentPetForDetail) {
        deletePet(currentPetForDetail.id);
      }
    });

    document.getElementById('closeDetailBtn').addEventListener('click', () => {
      document.getElementById('petDetailModal').classList.add('hidden');
      document.getElementById('petDetailModal').classList.remove('flex');
    });

    document.getElementById('petForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const photoFile = document.getElementById('petPhoto').files[0];
      
      const petData = {
        id: editingPetId || Date.now().toString(),
        name: formData.get('petName'),
        type: formData.get('petType'),
        breed: formData.get('breed'),
        birthDate: formData.get('birthDate'),
        gender: formData.get('gender'),
        neutered: formData.get('neutered'),
        weight: formData.get('weight'),
        notes: formData.get('notes'),
        photo: null
      };

      // ì‚¬ì§„ ì²˜ë¦¬
      if (photoFile) {
        const reader = new FileReader();
        reader.onload = function(e) {
          petData.photo = e.target.result;
          savePet(petData);
        };
        reader.readAsDataURL(photoFile);
      } else if (editingPetId) {
        // ìˆ˜ì • ì‹œ ê¸°ì¡´ ì‚¬ì§„ ìœ ì§€
        const existingPet = pets.find(p => p.id === editingPetId);
        petData.photo = existingPet ? existingPet.photo : null;
        savePet(petData);
      } else {
        savePet(petData);
      }
    });

    function savePet(petData) {
      if (editingPetId) {
        // ìˆ˜ì •
        const index = pets.findIndex(p => p.id === editingPetId);
        if (index !== -1) {
          pets[index] = petData;
        }
      } else {
        // ì¶”ê°€
        pets.push(petData);
      }

      localStorage.setItem('pets', JSON.stringify(pets));
      
      document.getElementById('petModal').classList.add('hidden');
      document.getElementById('petModal').classList.remove('flex');
      
      updatePetList();
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('petModal').addEventListener('click', (e) => {
      if (e.target.id === 'petModal') {
        document.getElementById('petModal').classList.add('hidden');
        document.getElementById('petModal').classList.remove('flex');
      }
    });

    document.getElementById('petDetailModal').addEventListener('click', (e) => {
      if (e.target.id === 'petDetailModal') {
        document.getElementById('petDetailModal').classList.add('hidden');
        document.getElementById('petDetailModal').classList.remove('flex');
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', initPage);
  </script>


</body>
</html>
