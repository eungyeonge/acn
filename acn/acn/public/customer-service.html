<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>고객센터 | ACN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="include.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <div id="header"></div>

  <section class="max-w-4xl mx-auto px-6 py-8">
    <div class="bg-white rounded-lg shadow-lg">
      <!-- 채팅 헤더 -->
      <div class="border-b p-4 bg-blue-600 text-white rounded-t-lg">
        <h1 class="text-xl font-bold">💬 고객센터 채팅</h1>
        <p class="text-sm opacity-90">무엇이든 물어보세요!</p>
      </div>

      <!-- 채팅 메시지 영역 -->
      <div id="chatMessages" class="h-96 overflow-y-auto p-4 space-y-4 bg-gray-50">
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-bold">
            AI
          </div>
          <div class="flex-1 bg-white rounded-lg p-3 shadow-sm">
            <p class="text-sm text-gray-700">안녕하세요! ACN 고객센터입니다. 무엇을 도와드릴까요? 😊</p>
          </div>
        </div>
      </div>

      <!-- 입력 영역 -->
      <div class="border-t p-4 bg-white rounded-b-lg">
        <div class="flex gap-2">
          <input 
            id="messageInput" 
            type="text" 
            placeholder="메시지를 입력하세요..."
            class="flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            onkeydown="if(event.key==='Enter'){sendMessage();}"
          />
          <button 
            onclick="sendMessage()" 
            id="sendBtn"
            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
            전송
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-2">Enter 키를 눌러도 전송됩니다.</p>
      </div>
    </div>
  </section>

  <div id="footer"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxXE-GP-tLNN5zZ81j-A0QtcN6RKIRxZE",
      authDomain: "acnproject-619dc.firebaseapp.com",
      projectId: "acnproject-619dc",
      storageBucket: "acnproject-619dc.firebasestorage.app",
      messagingSenderId: "205809961445",
      appId: "1:205809961445:web:7603261a5bae3316d7070c",
      measurementId: "G-4H0S2GDMGJ"
    };
    firebase.initializeApp(firebaseConfig);

    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');

    // 메시지 전송
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      // 사용자 메시지 표시
      addMessage(message, 'user');
      messageInput.value = '';
      sendBtn.disabled = true;
      messageInput.disabled = true;

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message })
        });

        if (!response.ok) {
          // 서버 오류 시 기본 응답 사용
          const defaultReply = getDefaultReply(message);
          addMessage(defaultReply, 'ai');
          sendBtn.disabled = false;
          messageInput.disabled = false;
          messageInput.focus();
          return;
        }

        const data = await response.json();

        if (data.success && data.reply) {
          addMessage(data.reply, 'ai');
        } else {
          // 응답이 없으면 기본 응답 사용
          const defaultReply = getDefaultReply(message);
          addMessage(defaultReply, 'ai');
        }
      } catch (error) {
        console.error('Chat error:', error);
        // 네트워크 오류 시에도 기본 응답 제공
        const defaultReply = getDefaultReply(message);
        addMessage(defaultReply, 'ai');
      } finally {
        sendBtn.disabled = false;
        messageInput.disabled = false;
        messageInput.focus();
      }
    }

    // 기본 응답 함수 (클라이언트 측)
    function getDefaultReply(message) {
      const lowerMessage = message.toLowerCase();
      
      // 예방접종 관련
      if (lowerMessage.includes("예방접종") || lowerMessage.includes("접종") || lowerMessage.includes("백신")) {
        if (lowerMessage.includes("강아지") || lowerMessage.includes("개")) {
          return "강아지 예방접종 정보입니다! 💉\n\n**필수 예방접종:**\n• 종합백신(DHPPL): 6~8주부터 시작, 3~4주 간격으로 3회\n• 코로나바이러스: 6~8주부터 시작\n• 켄넬코프(기관지염): 6~8주부터 시작\n• 광견병: 3개월 이상, 1년마다 접종\n\n**권장 예방접종:**\n• 인플루엔자: 매년 접종\n• 레프토스피라: 지역에 따라 필요\n\n접종 일정은 마이페이지의 '예방접종 캘린더'에서 관리하실 수 있습니다!";
        } else if (lowerMessage.includes("고양이") || lowerMessage.includes("고양")) {
          return "고양이 예방접종 정보입니다! 💉\n\n**필수 예방접종:**\n• 3종 혼합백신(FVRCP): 6~8주부터 시작, 3~4주 간격으로 2~3회\n  - 범백혈구감소증(팬루코페니아)\n  - 바이러스성 비기관지염(헤르페스)\n  - 칼리시바이러스\n• 광견병: 3개월 이상, 1~3년마다 접종\n\n**권장 예방접종:**\n• 백혈병(FeLV): 실외 고양이, 다묘 가정\n• 클라미디아: 다묘 가정\n\n접종 일정은 마이페이지의 '예방접종 캘린더'에서 관리하실 수 있습니다!";
        } else {
          return "예방접종에 대해 물어보셨네요! 💉\n\n**강아지 필수 접종:** 종합백신(DHPPL), 코로나바이러스, 광견병\n**고양이 필수 접종:** 3종 혼합백신(FVRCP), 광견병\n\n구체적인 접종 일정은 반려동물의 나이와 종류에 따라 다릅니다. 동물병원에서 상담받으시거나 마이페이지의 '예방접종 캘린더'를 이용해보세요!";
        }
      }
      // 홈페이지 관련 질문
      else if (lowerMessage.includes("펫보험") || lowerMessage.includes("보험")) {
        return "펫보험에 관심이 있으시군요! ACN에서는 다양한 펫보험 상품을 제공하고 있습니다. 상단 메뉴의 '반려동물 보험'에서 보험사별 상품을 비교하고 가입하실 수 있습니다. 질병 치료비, 수술비, 입원비 등을 보장하는 상품들이 있어요. 💳";
      } else if (lowerMessage.includes("사료") || lowerMessage.includes("먹이")) {
        return "사료 관련 문의사항이시군요! ACN에서는 다양한 프리미엄 사료를 제공하고 있습니다. 상품 페이지에서 카테고리를 선택하시면 원하시는 사료를 찾으실 수 있습니다. 추가로 궁금한 점이 있으시면 언제든 말씀해주세요! 🐕";
      } else if (lowerMessage.includes("간식")) {
        return "간식에 대해 물어보셨네요! 우리 플랫폼에서는 건강한 천연 간식부터 특별한 날을 위한 간식까지 다양한 제품을 만나보실 수 있습니다. 간식 카테고리를 확인해보세요! 🦴";
      } else if (lowerMessage.includes("병원") || lowerMessage.includes("의원")) {
        return "동물병원 찾기 서비스를 이용하시려면 상단 메뉴의 '동물병원조회'를 클릭해주세요. 지역명이나 병원 이름으로 검색하실 수 있습니다. 🏥";
      } else if (lowerMessage.includes("주문") || lowerMessage.includes("배송")) {
        return "주문 및 배송 관련 문의는 마이페이지의 주문 내역에서 확인하실 수 있습니다. 배송 문의는 주문 번호와 함께 고객센터로 연락주시면 빠르게 도와드리겠습니다! 📦";
      } else if (lowerMessage.includes("반품") || lowerMessage.includes("교환")) {
        return "반품/교환은 상품 수령 후 7일 이내에 가능합니다. 마이페이지에서 신청하시거나 고객센터로 연락주시면 안내해드리겠습니다. 🔄";
      }
      // 일반 반려동물 질문
      else if (lowerMessage.includes("강아지") || lowerMessage.includes("개")) {
        if (lowerMessage.includes("먹이") || lowerMessage.includes("사료") || lowerMessage.includes("식사")) {
          return "강아지 식사 관련 정보입니다! 🐕\n\n• 하루 식사 횟수: 성견은 1~2회, 강아지는 3~4회\n• 급여량: 체중의 2~3% 정도 (사료 종류에 따라 다름)\n• 식사 시간: 규칙적으로 같은 시간에 급여\n• 물: 항상 깨끗한 물을 충분히 제공\n\n고품질 사료를 선택하시려면 상품 페이지의 사료 카테고리를 확인해보세요!";
        } else if (lowerMessage.includes("산책") || lowerMessage.includes("운동")) {
          return "강아지 산책과 운동에 대해 물어보셨네요! 🐕\n\n• 산책 시간: 하루 2~3회, 총 30분~2시간 (견종과 나이에 따라 다름)\n• 강아지: 짧은 산책부터 시작, 점진적으로 늘리기\n• 성견: 충분한 운동량 확보\n• 날씨: 너무 더운 날이나 추운 날에는 주의\n\n산책용 용품은 상품 페이지에서 확인하실 수 있습니다!";
        } else if (lowerMessage.includes("목욕") || lowerMessage.includes("샴푸")) {
          return "강아지 목욕 정보입니다! 🐕\n\n• 목욕 빈도: 보통 2~4주에 1회 (견종과 피부 상태에 따라 다름)\n• 강아지: 3개월 이후부터 시작\n• 샴푸: 강아지 전용 샴푸 사용\n• 물 온도: 미지근한 물 사용\n• 건조: 완전히 말려주기\n\n강아지 전용 샴푸와 용품은 상품 페이지에서 구매하실 수 있습니다!";
        } else {
          return "강아지에 대해 물어보셨네요! 🐕\n\n강아지 관련하여 사료, 간식, 용품, 예방접종, 건강 관리 등 다양한 정보를 제공하고 있습니다. 구체적으로 어떤 것이 궁금하신가요? (예: 식사, 산책, 목욕, 예방접종 등)";
        }
      } else if (lowerMessage.includes("고양이") || lowerMessage.includes("고양")) {
        if (lowerMessage.includes("먹이") || lowerMessage.includes("사료") || lowerMessage.includes("식사")) {
          return "고양이 식사 관련 정보입니다! 🐱\n\n• 하루 식사 횟수: 성묘는 2~3회, 새끼고양이는 4~6회\n• 급여량: 체중의 2~3% 정도\n• 식사 시간: 규칙적으로 같은 시간에 급여\n• 물: 항상 깨끗한 물을 충분히 제공 (자동 급수기 권장)\n• 습식 사료: 수분 섭취에 도움\n\n고품질 사료를 선택하시려면 상품 페이지의 사료 카테고리를 확인해보세요!";
        } else if (lowerMessage.includes("화장실") || lowerMessage.includes("배변") || lowerMessage.includes("모래")) {
          return "고양이 화장실 관리 정보입니다! 🐱\n\n• 화장실 개수: 고양이 수 + 1개\n• 모래 깊이: 5~7cm 정도\n• 청소: 하루 1~2회 배변물 제거, 주 1회 전체 교체\n• 위치: 조용하고 사적인 공간\n• 모래 종류: 벤토나이트, 두부모래, 목재 등\n\n배변패드와 모래는 상품 페이지에서 구매하실 수 있습니다!";
        } else if (lowerMessage.includes("목욕") || lowerMessage.includes("샴푸")) {
          return "고양이 목욕 정보입니다! 🐱\n\n• 목욕 빈도: 보통 필요 없음 (고양이는 스스로 청소)\n• 목욕이 필요한 경우: 피부 질환, 오염 등\n• 고양이 전용 샴푸 사용\n• 물 온도: 미지근한 물\n• 건조: 완전히 말려주기\n• 스트레스 최소화\n\n고양이 전용 샴푸는 상품 페이지에서 구매하실 수 있습니다!";
        } else {
          return "고양이에 대해 물어보셨네요! 🐱\n\n고양이 관련하여 사료, 간식, 용품, 예방접종, 건강 관리 등 다양한 정보를 제공하고 있습니다. 구체적으로 어떤 것이 궁금하신가요? (예: 식사, 화장실, 목욕, 예방접종 등)";
        }
      } else if (lowerMessage.includes("건강") || lowerMessage.includes("질병") || lowerMessage.includes("병")) {
        return "반려동물 건강에 대해 물어보셨네요! 🏥\n\n• 정기 검진: 1년에 1~2회 권장\n• 예방접종: 정기적으로 접종\n• 구충제: 정기적으로 투여\n• 이상 징후 발견 시 즉시 병원 방문\n\n건강 관련 문의는 동물병원에서 전문적인 상담을 받으시는 것을 권장합니다. 동물병원 찾기는 상단 메뉴의 '동물병원조회'를 이용해보세요!";
      } else if (lowerMessage.includes("훈련") || lowerMessage.includes("교육")) {
        return "반려동물 훈련에 대해 물어보셨네요! 🎓\n\n• 강아지: 기본 명령어(앉아, 기다려, 와 등)부터 시작\n• 긍정적 강화: 간식과 칭찬 활용\n• 일관성: 같은 명령어와 규칙 유지\n• 짧은 시간: 10~15분씩 자주 반복\n• 전문가 도움: 필요시 훈련사 상담\n\n훈련용 간식은 상품 페이지에서 구매하실 수 있습니다!";
      } else {
        return "안녕하세요! ACN 고객센터입니다. 반려동물 관련하여 사료, 간식, 용품, 동물병원, 펫보험, 유기동물, 예방접종 등 다양한 정보를 제공하고 있습니다. 구체적으로 어떤 도움이 필요하신가요? 😊\n\n예: 예방접종, 강아지 식사, 고양이 화장실, 건강 관리 등";
      }
    }

    // 메시지 추가
    function addMessage(text, sender, isLoading = false) {
      const messageId = 'msg-' + Date.now();
      const messageDiv = document.createElement('div');
      
      if (sender === 'user') {
        // 사용자 메시지: 오른쪽 정렬
        messageDiv.className = 'flex items-start gap-3 justify-end';
        messageDiv.innerHTML = `
          <div class="bg-blue-500 text-white rounded-lg p-3 shadow-sm max-w-[80%]">
            <p class="text-sm text-white">${text}</p>
            ${isLoading ? '<div class="mt-2 flex gap-1"><div class="w-2 h-2 bg-white rounded-full animate-bounce"></div><div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div>' : ''}
          </div>
          <div class="w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">나</div>
        `;
      } else {
        // AI 메시지: 왼쪽 정렬
        messageDiv.className = 'flex items-start gap-3';
        messageDiv.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">AI</div>
          <div class="bg-white rounded-lg p-3 shadow-sm max-w-[80%]">
            <p class="text-sm text-gray-700">${text}</p>
            ${isLoading ? '<div class="mt-2 flex gap-1"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div>' : ''}
          </div>
        `;
      }
      
      messageDiv.id = messageId;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      return messageId;
    }

    // 메시지 제거 (로딩용)
    function removeMessage(messageId) {
      const message = document.getElementById(messageId);
      if (message) {
        message.remove();
      }
    }

    // 페이지 로드 시 입력창 포커스
    window.onload = () => {
      messageInput.focus();
    };
  </script>

</body>
</html>

