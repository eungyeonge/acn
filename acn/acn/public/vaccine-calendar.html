<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜ˆë°©ì ‘ì¢… ìŠ¤ì¼€ì¤„ | ACN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="include.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- âœ… í—¤ë” ìë™ ì‚½ì… -->
  <div id="header"></div>

  <!-- âœ… ì˜ˆë°©ì ‘ì¢… ìŠ¤ì¼€ì¤„ ë‹¬ë ¥ -->
  <section class="max-w-6xl mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
      <h1 class="text-2xl font-bold mb-6 text-center">ì˜ˆë°©ì ‘ì¢… ìŠ¤ì¼€ì¤„ ê´€ë¦¬</h1>
      
      <!-- ë‹¬ë ¥ ì»¨íŠ¸ë¡¤ -->
      <div class="flex justify-between items-center mb-6">
        <button id="prevMonth" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          â—€ ì´ì „
        </button>
        <h2 id="currentMonth" class="text-xl font-semibold"></h2>
        <button id="nextMonth" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
          ë‹¤ìŒ â–¶
        </button>
      </div>

      <!-- ë‹¬ë ¥ ê·¸ë¦¬ë“œ -->
      <div class="grid grid-cols-7 gap-1 mb-4">
        <div class="p-2 text-center font-semibold text-gray-600">ì¼</div>
        <div class="p-2 text-center font-semibold text-gray-600">ì›”</div>
        <div class="p-2 text-center font-semibold text-gray-600">í™”</div>
        <div class="p-2 text-center font-semibold text-gray-600">ìˆ˜</div>
        <div class="p-2 text-center font-semibold text-gray-600">ëª©</div>
        <div class="p-2 text-center font-semibold text-gray-600">ê¸ˆ</div>
        <div class="p-2 text-center font-semibold text-gray-600">í† </div>
      </div>
      
      <div id="calendar" class="grid grid-cols-7 gap-1 mb-6">
        <!-- ë‹¬ë ¥ ë‚ ì§œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>

      <!-- ì˜ˆë°©ì ‘ì¢… ì¶”ê°€ ë²„íŠ¼ -->
      <div class="text-center mb-6">
        <button id="addVaccineBtn" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold">
          + ì˜ˆë°©ì ‘ì¢… ì¼ì • ì¶”ê°€
        </button>
      </div>

      <!-- ì˜ˆë°©ì ‘ì¢… ëª©ë¡ -->
      <div class="border-t pt-6">
        <h3 class="text-lg font-semibold mb-4">ì˜ˆì •ëœ ì˜ˆë°©ì ‘ì¢…</h3>
        <div id="vaccineList" class="space-y-3">
          <!-- ì˜ˆë°©ì ‘ì¢… ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>
  </section>

  <!-- ì˜ˆë°©ì ‘ì¢… ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="vaccineModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
      <h3 id="modalTitle" class="text-lg font-semibold mb-4">ì˜ˆë°©ì ‘ì¢… ì¼ì • ì¶”ê°€</h3>
      
      <form id="vaccineForm">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="vaccineName">ì˜ˆë°©ì ‘ì¢…ëª…</label>
          <input type="text" id="vaccineName" name="vaccineName" placeholder="ì˜ˆ: ì¢…í•©ë°±ì‹ , ê´‘ê²¬ë³‘ ë“±" 
                 class="w-full border px-3 py-2 rounded" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="petName">ë°˜ë ¤ë™ë¬¼</label>
          <select id="petName" name="petName" class="w-full border px-3 py-2 rounded" required>
            <option value="">ë°˜ë ¤ë™ë¬¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
            <!-- ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </select>
          <p class="text-xs text-gray-500 mt-1">
            ë°˜ë ¤ë™ë¬¼ì´ ì—†ë‹¤ë©´ 
            <a href="pet-management.html" class="text-blue-600 hover:underline">ì—¬ê¸°ì„œ ë¨¼ì € ë“±ë¡</a>í•´ì£¼ì„¸ìš”.
          </p>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="vaccineDate">ì ‘ì¢… ì˜ˆì •ì¼</label>
          <input type="date" id="vaccineDate" name="vaccineDate" 
                 class="w-full border px-3 py-2 rounded" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="vaccineTime">ì ‘ì¢… ì‹œê°„</label>
          <input type="time" id="vaccineTime" name="vaccineTime" 
                 class="w-full border px-3 py-2 rounded">
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="hospital">ë³‘ì›ëª…</label>
          <input type="text" id="hospital" name="hospital" placeholder="ì˜ˆ: â—‹â—‹ë™ë¬¼ë³‘ì›" 
                 class="w-full border px-3 py-2 rounded">
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1" for="notes">ë©”ëª¨</label>
          <textarea id="notes" name="notes" placeholder="íŠ¹ì´ì‚¬í•­ì´ë‚˜ ì£¼ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" 
                    class="w-full border px-3 py-2 rounded h-20"></textarea>
        </div>
        
        <div class="flex gap-3">
          <button type="button" id="cancelBtn" class="flex-1 px-4 py-2 border rounded hover:bg-gray-50">
            ì·¨ì†Œ
          </button>
          <button type="submit" class="flex-1 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
            ì €ì¥
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- í‘¸í„° ìë™ ì‚½ì… -->
  <div id="footer"></div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxXE-GP-tLNN5zZ81j-A0QtcN6RKIRxZE",
      authDomain: "acnproject-619dc.firebaseapp.com",
      projectId: "acnproject-619dc",
      storageBucket: "acnproject-619dc.firebasestorage.app",
      messagingSenderId: "205809961445",
      appId: "1:205809961445:web:7603261a5bae3316d7070c",
      measurementId: "G-4H0S2GDMGJ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Firebase ì¸ì¦ ìƒíƒœ ì²´í¬
    auth.onAuthStateChanged((user) => {
      if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "login.html";
      }
    });

    // ì „ì—­ ë³€ìˆ˜
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let editingVaccineId = null;

    // ì˜ˆë°©ì ‘ì¢… ë°ì´í„° (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°)
    let vaccines = JSON.parse(localStorage.getItem('vaccines') || '[]');

    // ë‹¬ë ¥ ì´ˆê¸°í™”
    function initCalendar() {
      loadPetOptions();
      updateCalendar();
      updateVaccineList();
    }

    // ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadPetOptions() {
      const pets = JSON.parse(localStorage.getItem('pets') || '[]');
      const petSelect = document.getElementById('petName');
      
      // ê¸°ì¡´ ì˜µì…˜ë“¤ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
      while (petSelect.children.length > 1) {
        petSelect.removeChild(petSelect.lastChild);
      }
      
      // ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ë“¤ ì¶”ê°€
      pets.forEach(pet => {
        const option = document.createElement('option');
        option.value = pet.name;
        option.textContent = `${pet.name} (${getTypeText(pet.type)})`;
        petSelect.appendChild(option);
      });
    }

    // ì¢…ë¥˜ë³„ í…ìŠ¤íŠ¸ (ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬ í˜ì´ì§€ì™€ ë™ì¼)
    function getTypeText(type) {
      const texts = {
        dog: 'ê°•ì•„ì§€',
        cat: 'ê³ ì–‘ì´',
        rabbit: 'í† ë¼', 
        hamster: 'í–„ìŠ¤í„°',
        bird: 'ìƒˆ',
        fish: 'ë¬¼ê³ ê¸°',
        other: 'ê¸°íƒ€'
      };
      return texts[type] || 'ì•Œ ìˆ˜ ì—†ìŒ';
    }

    // ë‹¬ë ¥ ì—…ë°ì´íŠ¸
    function updateCalendar() {
      const monthNames = [
        "1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”",
        "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"
      ];
      
      document.getElementById('currentMonth').textContent = 
        `${currentYear}ë…„ ${monthNames[currentMonth]}`;

      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      // í•´ë‹¹ ì›”ì˜ ì²« ë²ˆì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());

      // 6ì£¼ì¹˜ ë‹¬ë ¥ ìƒì„± (42ì¼)
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayElement = document.createElement('div');
        dayElement.className = 'p-2 text-center border min-h-[60px] relative';
        
        // ë‹¤ë¥¸ ì›”ì˜ ë‚ ì§œëŠ” íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œ
        if (date.getMonth() !== currentMonth) {
          dayElement.classList.add('text-gray-400', 'bg-gray-50');
        }
        
        // ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡°
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
          dayElement.classList.add('bg-blue-100', 'font-semibold');
        }
        
        dayElement.innerHTML = `
          <div class="text-sm">${date.getDate()}</div>
          <div class="text-xs mt-1 space-y-1" id="vaccines-${date.toDateString()}"></div>
        `;
        
        calendar.appendChild(dayElement);
      }

      // ì˜ˆë°©ì ‘ì¢… ì¼ì • í‘œì‹œ
      displayVaccinesOnCalendar();
    }

    // ë‹¬ë ¥ì— ì˜ˆë°©ì ‘ì¢… í‘œì‹œ
    function displayVaccinesOnCalendar() {
      vaccines.forEach(vaccine => {
        const vaccineDate = new Date(vaccine.date);
        const dateString = vaccineDate.toDateString();
        const container = document.getElementById(`vaccines-${dateString}`);
        
        if (container) {
          const vaccineElement = document.createElement('div');
          vaccineElement.className = 'bg-red-100 text-red-800 text-xs p-1 rounded truncate cursor-pointer';
          vaccineElement.title = `${vaccine.petName} - ${vaccine.name}`;
          vaccineElement.textContent = vaccine.name;
          vaccineElement.onclick = () => editVaccine(vaccine.id);
          container.appendChild(vaccineElement);
        }
      });
    }

    // ì˜ˆë°©ì ‘ì¢… ëª©ë¡ ì—…ë°ì´íŠ¸
    function updateVaccineList() {
      const vaccineList = document.getElementById('vaccineList');
      vaccineList.innerHTML = '';

      if (vaccines.length === 0) {
        vaccineList.innerHTML = '<p class="text-gray-500 text-center py-4">ë“±ë¡ëœ ì˜ˆë°©ì ‘ì¢… ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
      const sortedVaccines = [...vaccines].sort((a, b) => new Date(a.date) - new Date(b.date));

      sortedVaccines.forEach(vaccine => {
        const vaccineElement = document.createElement('div');
        vaccineElement.className = 'border rounded-lg p-4 hover:bg-gray-50';
        
        const vaccineDate = new Date(vaccine.date);
        const isPast = vaccineDate < new Date();
        const isToday = vaccineDate.toDateString() === new Date().toDateString();
        
        let statusClass = '';
        let statusText = '';
        
        if (isPast) {
          statusClass = 'bg-gray-100 text-gray-600';
          statusText = 'ì™„ë£Œ';
        } else if (isToday) {
          statusClass = 'bg-red-100 text-red-600';
          statusText = 'ì˜¤ëŠ˜';
        } else {
          statusClass = 'bg-blue-100 text-blue-600';
          statusText = 'ì˜ˆì •';
        }

        vaccineElement.innerHTML = `
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <h4 class="font-semibold">${vaccine.name}</h4>
                <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${statusText}</span>
              </div>
              <p class="text-sm text-gray-600 mb-1">ğŸ¾ ${vaccine.petName}</p>
              <p class="text-sm text-gray-600 mb-1">ğŸ“… ${vaccineDate.toLocaleDateString('ko-KR')} ${vaccine.time || ''}</p>
              ${vaccine.hospital ? `<p class="text-sm text-gray-600 mb-1">ğŸ¥ ${vaccine.hospital}</p>` : ''}
              ${vaccine.notes ? `<p class="text-sm text-gray-500">${vaccine.notes}</p>` : ''}
            </div>
            <div class="flex gap-2 ml-4">
              <button onclick="editVaccine('${vaccine.id}')" class="text-blue-600 hover:text-blue-800 text-sm">ìˆ˜ì •</button>
              <button onclick="deleteVaccine('${vaccine.id}')" class="text-red-600 hover:text-red-800 text-sm">ì‚­ì œ</button>
            </div>
          </div>
        `;
        
        vaccineList.appendChild(vaccineElement);
      });
    }

    // ì˜ˆë°©ì ‘ì¢… ì¶”ê°€
    function addVaccine() {
      editingVaccineId = null;
      document.getElementById('modalTitle').textContent = 'ì˜ˆë°©ì ‘ì¢… ì¼ì • ì¶”ê°€';
      document.getElementById('vaccineForm').reset();
      loadPetOptions(); // ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
      document.getElementById('vaccineModal').classList.remove('hidden');
      document.getElementById('vaccineModal').classList.add('flex');
    }

    // ì˜ˆë°©ì ‘ì¢… ìˆ˜ì •
    function editVaccine(id) {
      const vaccine = vaccines.find(v => v.id === id);
      if (!vaccine) return;

      editingVaccineId = id;
      document.getElementById('modalTitle').textContent = 'ì˜ˆë°©ì ‘ì¢… ì¼ì • ìˆ˜ì •';
      
      loadPetOptions(); // ë°˜ë ¤ë™ë¬¼ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
      
      // í¼ì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
      document.getElementById('vaccineName').value = vaccine.name;
      document.getElementById('petName').value = vaccine.petName;
      document.getElementById('vaccineDate').value = vaccine.date;
      document.getElementById('vaccineTime').value = vaccine.time || '';
      document.getElementById('hospital').value = vaccine.hospital || '';
      document.getElementById('notes').value = vaccine.notes || '';
      
      document.getElementById('vaccineModal').classList.remove('hidden');
      document.getElementById('vaccineModal').classList.add('flex');
    }

    // ì˜ˆë°©ì ‘ì¢… ì‚­ì œ
    function deleteVaccine(id) {
      if (confirm('ì •ë§ë¡œ ì´ ì˜ˆë°©ì ‘ì¢… ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        vaccines = vaccines.filter(v => v.id !== id);
        localStorage.setItem('vaccines', JSON.stringify(vaccines));
        updateCalendar();
        updateVaccineList();
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('prevMonth').addEventListener('click', () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      updateCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      updateCalendar();
    });

    document.getElementById('addVaccineBtn').addEventListener('click', addVaccine);

    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('vaccineModal').classList.add('hidden');
      document.getElementById('vaccineModal').classList.remove('flex');
    });

    document.getElementById('vaccineForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const vaccineData = {
        id: editingVaccineId || Date.now().toString(),
        name: formData.get('vaccineName'),
        petName: formData.get('petName'),
        date: formData.get('vaccineDate'),
        time: formData.get('vaccineTime'),
        hospital: formData.get('hospital'),
        notes: formData.get('notes')
      };

      if (editingVaccineId) {
        // ìˆ˜ì •
        const index = vaccines.findIndex(v => v.id === editingVaccineId);
        if (index !== -1) {
          vaccines[index] = vaccineData;
        }
      } else {
        // ì¶”ê°€
        vaccines.push(vaccineData);
      }

      localStorage.setItem('vaccines', JSON.stringify(vaccines));
      
      document.getElementById('vaccineModal').classList.add('hidden');
      document.getElementById('vaccineModal').classList.remove('flex');
      
      updateCalendar();
      updateVaccineList();
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    document.getElementById('vaccineModal').addEventListener('click', (e) => {
      if (e.target.id === 'vaccineModal') {
        document.getElementById('vaccineModal').classList.add('hidden');
        document.getElementById('vaccineModal').classList.remove('flex');
      }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¬ë ¥ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', initCalendar);
  </script>


</body>
</html>

